<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Zodiac Memory Game</title>
        <link rel="stylesheet" href="assets/styles.css">

    </head>
    <body>
        <h1>
            Zodiac Memory Matching Game</h1>
        <!--first button set -->


        <p id="row1">
            <button id="btn1"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn2"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn3"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn4"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn5"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn6"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn7"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn8"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn9"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn10"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn11"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn12"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
        </p>


        <!--Second button set-->

        <p id="row2">
            <button id="btn13"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn14"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn15"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn16"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn17"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn18"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn19"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn20"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn21"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn22"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn23"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
            <button id="btn24"><img src="assets/images/13-card-before/card-before-flipping.png" alt="card-back"></button>
        </p>


        <script>
            // card images
            const topCards = [
                "assets/images/Aries/Aries.png",
                "assets/images/Taurus/Taurus.png",
                "assets/images/Gemini/Gemini.png",
                "assets/images/Cancer/Cancer.png",
                "assets/images/Leo/Leo.png",
                "assets/images/Virgo/Virgo.png",
                "assets/images/Libra/Libra.png",
                "assets/images/Scorpio/Scorpio.png",
                "assets/images/Sagittarius/Sagittarius.png",
                "assets/images/Capricorn/Capricorn.png",
                "assets/images/Aquarius/Aquarius.png",
                "assets/images/Pisces/Pisces.png"
            ];
            // duplicate card images for the bottom row
            const bottomCards = [... topCards];

            // shuffle both rows
            topCards.sort(() => 0.5 - Math.random());
            bottomCards.sort(() => 0.5 - Math.random());

            // track game state
            let firstFlippedCard = null; // store first flipped card
            let firstFlippedButton = null; // store the first flipped button
            let firstFlippedRow = null; // store the first flipped row
            let isFlippingAllowed = true; // test whether simultaneous flipping is allowed
            let allowFlippingTopRow = true; // control flipping top row
            let allowFlippingBottomRow = true; // control flipping bottom row
            let score = 0;

            // this is not working, code is catastrophic
            //Restrict one card flip per row, add to the function handle flip
            let isTopRowFlipped = false;
            let isBottomRowFlipped = false;
            // handle flipping function
            
            function handleFlip(button, cardImage, row) {
                if (!isFlippingAllowed) 
                    return;
                if (row === 'top' && isTopRowFlipped){
                    alert ('You have to pick a card from the bottom row now!') 
                    return;
                }
                if (row === 'bottom' && isBottomRowFlipped){
                    alert ('You have already flipped one card in the bottom row') 
                    return;
                }
                /*
                // don't flip in the same row
                if (firstFlippedRow === row) {
                    alert('You must select card from the second row')
                    return;
                }
                    */
                const img = button.querySelector("img");
                // don't flip the same card twice
                if (img.src.includes(cardImage)) {
                    return;
                }

                //flip card
                img.src = cardImage;


                // prevent flipping cards in the same row, if one is flipped.
                if ((row === 'top' && !allowFlippingTopRow) || (row === 'bottom' && ! allowFlippingBottomRow)) 
                    return;
                


                // flip card
                img.src = cardImage;
                if (! firstFlippedCard) { // first card flipped
                    firstFlippedCard = cardImage;
                    firstFlippedButton = button;
                    firstFlippedRow = row;

                    // disable flipping in the same row:
                    if (row === 'top') {
                        allowFlippingTopRow = false;
                    } else {
                        allowFlippingBottomRow = false;
                    }
                } else { // second card flipped
                    isFlippingAllowed = false;
                    if (firstFlippedCard === cardImage) {
                        score += 1;
                        alert(`It's a match! Current score: ${score}`);
                        resetFlipState();
                    } else  // if cards don't match
                        alert('Not a match');
                    


                    setTimeout(() => {
                        img.src = "assets/images/13-card-before/card-before-flipping.png";
                        firstFlippedButton.querySelector("img").src = "assets/images/13-card-before/card-before-flipping.png";
                        resetFlipState();
                    }, 1000);
                } else {
                    alert('You must select card from the other row!');
                }
                // reset flipped card tracking-- update to function to be called up under the else statement on row 120
                function resetFlipState() {
                    firstFlippedCard = null;
                    firstFlippedButton = null;
                    firstFlippedRow = null;
                    isFlippingAllowed = true;
                    allowFlippingTopRow = true;
                    allowFlippingBottomRow = true;
                }
            }


            // Asign image to buttons in the top row
            for (let i = 1; i <= 12; i++) {
                const button = document.getElementById(`btn${i}`);
                const cardImage = topCards[i - 1];
                button.addEventListener("click", () => handleFlip(button, cardImage, 'top'));
            }
            // Asign image to buttons in the bottom row
            for (let i = 13; i <= 24; i++) {
                const button = document.getElementById(`btn${i}`);
                const cardImage = bottomCards[i - 13];
                button.addEventListener("click", () => handleFlip(button, cardImage, 'bottom'));
            }
        </script>

    </body>
</html>
